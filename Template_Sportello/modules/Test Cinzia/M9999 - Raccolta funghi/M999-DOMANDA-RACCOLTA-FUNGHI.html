{% set CodiceModulo = "M1234-TEST-ANDREA" %}
{% set Urn = "document:c_l378:test.modulo.andrea;servizio.test.andrea;modulo.test.andrea" %}
{% extends "base_trento_ok.html" %}

{% block meta %}

<meta campi_firma="AventeTitolo_CodiceFiscale"
campi_firma_label="il dichiarante"
classi_modulo="Turismo"
codice_modulo="{{ CodiceModulo }}"
urn="{{ Urn }}"
sub_urn_list=""
uo_globo_list=""
contesto_procedurale="Turismo"
descrizione="Domanda raccolta funghi"
destinatario_amministrazione=""
destinatario_ufficio="DICLGP"
dinamico="SI"
email_a=""
ente_abilitato="TUTTI"
filigrana="NO"
firmare="AUTENTICATO"
istruzioni_compilazione=""
istruzioni_invio="mail_pec"
metodo_invio="mail"
name="GLOBO_modulo"
procura="NO,,"
segnatura="AventeTitolo"
tipo_modulo="principale"
urlhelp="/modulistica/moduli/{{ CodiceModulo }}"
verifica_pagamento="NO"
versione="1.0|24/02/2018" />

<meta codice_report="CSP_SESSION_REPORT"
generate_on="sending"
name="GLOBO_report"
urn_report="report:CSP_SESSION_REPORT"/>

{% endblock meta %}

{% block title %}
M9999-DOMANDA-RACCOLTA-FUNGHI
{% endblock title %}

{% block content %}

<globo_fondo_pagina areaheight="150" scope="1">
  {{ utils.firma() }}
</globo_fondo_pagina>

<input id="Parametri_Comune" name="Parametri_Comune" type="hidden" dynamic_value="#Ente.value()"/>
<input id="Oggetto" name="Oggetto" type="hidden" dynamic_value="#AventeTitolo_Cognome.value().toUpperCase() + ' ' + #AventeTitolo_Nome.value().toUpperCase() + ' - Raccolta funghi'"/>

{{ intestazioni.intestazione_moduloprincipale_senzabollo() }}

<h1 class="Modulo">
  Modulo per la domanda di raccolta funghi spontanei nel Comune di Trento</i>
</h1>

<input id="AventeTitolo_DatiPersonaObbligatori" name="AventeTitolo_DatiPersonaObbligatori" type="hidden" dynamic_check="true"/>
<input id="AventeTitolo_Titolo" name="AventeTitolo_Titolo" type="hidden" value="Richiedente"/>
<input id="AventeTitolo_Ruolo" name="AventeTitolo_Ruolo" type="hidden" value="Richiedente"/>


<!-- *********** INIZIO MODULO ANAGRAFICA *********** -->
<input type="hidden" name="TipoContesto" id="TipoContesto" value="GLOBO">
<input type="hidden" name="TipoLista" id="TipoLista" value="PGLOBO">

<input id="cellulare_obbligatorio" name="cellulare_obbligatorio" dynamic_check="true" type="hidden" />
<input id="mail_obbligatoria" name="mail_obbligatoria" dynamic_check="true" type="hidden" />
{{anagrafica_trento_uniformata.richiedente("AventeTitolo","Il/La sottoscritto/a, avente codice fiscale:", "visibility:visibility", "cursor:pointer", "visibility:visibility")}} 

<!-- *********** FINE MODULO ANAGRAFICA *********** -->

<br>

<!-- *********** INIZIO MODULO  ***********-->
<div>
  <h3 class="Modulo">
    <b>CHIEDE</b>
  </h3>
  <h4>
  </h4>
  <p class="Modulo">il permesso per la raccolta di funghi spontanei in quantità non superiore a 2 chilogrammi al giorno per persona, 
    nell'ambito del Comune di Trento per l'anno 
    <input class="inputNormal" id="Parametri_Anno" name="Parametri_Anno" label="Anno di raccolta" mandatory_enabled="true" format="number" maxlength="4" size="4" />
    e per il seguente periodo:
  </p>
  <br/>  

  <table class="Modulo" style="border: 1px solid grey">
    <tbody> 
      <tr class="Rigaintestazione">
        <td>
          <div id="periodo_scelto" name="Periodo_raccolta" label="Periodo di raccolta" mandatory="true"></div>
        </td>
      </tr>
      <tr>
        <td>
            <input group="periodo_scelto" id="Periodo_raccolta1" type="radio" name="Periodo_raccolta" value="10" checked onchange="updateImporto()"/> 
            1 giorno
        </td> 
      </tr> 
      <tr>
        <td>
            <input group="periodo_scelto" id="Periodo_raccolta2" type="radio" name="Periodo_raccolta" value="18" onchange="updateImporto()"/> 
            3 giorni
        </td> 
      </tr> 
      <tr>
        <td>
          <input group="periodo_scelto" id="Periodo_raccolta3" type="radio" name="Periodo_raccolta" value="24" onchange="updateImporto()"/> 
          1 settimana
        </td> 
      </tr> 
      <tr>
        <td>
          <input group="periodo_scelto" id="Periodo_raccolta4" type="radio" name="Periodo_raccolta" value="40" onchange="updateImporto()"/> 
          2 settimane
        </td> 
      </tr> 
      <tr>
        <td>
          <input group="periodo_scelto" id="Periodo_raccolta5" type="radio" name="Periodo_raccolta" value="60" onchange="updateImporto()"/> 
          1 mese
        </td> 
      </tr> 
    </tbody>
  </table>
</div>
    
<!-- *********** FINE MODULO UTILIZZO SALE *********** -->

<br>


<!-- *********** INIZIO PAGAMENTO MARCA DA BOLLO *********** -->
<h3 class="Modulo">
  Inoltre DICHIARA
</h3>
<br>

{% block dichiarazioni_minore %}
<table class="Modulo" name="Dic_minore" style="border: 1px solid grey">
  <tbody>
    <tr>
      <td class="tabled-cb" >
        <div id="Minore" name="Minore" label="Indicare se minore"> </div>
        <input id="Minore_check" name="Minore_check" type="checkbox" value="SI" style="margin-top: 0.2rem;" />
      </td>
      <td style="background-color: #eeeeee;">
        <p style="line-height:1.4;">di accompagnare il minore di 10 anni</p>
        <input class="inputNormal" id="Dic_minore_nomecognome" name="Dic_minore_nomecognome" style="width: 100%;" label="" mandatory_enabled="#Minore_check.checked()" placeholder="Inserire nome e cognome del minore" />
      </td>
    </tr>
  </tbody>
</table>
{% endblock dichiarazioni_minore %}

<br/>



<br/>
{% block dichiarazioni_esenzioni %}
<table class="Modulo" name="Dichiarazione_Esenzioni" style="border: 1px solid grey">
    <tbody>
      <tr class="Rigaintestazione">
        <td colspan="2">
          <p style="line-height: 1.6;">di essere <b>esentato/a</b> dal pagamento dell'importo fissato, per una delle seguenti motivazioni:
          </p>
        </td>
      </tr>
  
        <div id="Tassonomia_Esenzioni" name="Tassonomia_Esenzioni" label="Indicare le esenzioni di cui si necessita per l'espletamento della prova orale se in possesso di certificazione medica"></div> 
      
        <tr>
          <td class="tabled-cb">
            <input group="Tassonomia_Esenzioni" id="Tassonomia_Esenzioni1" name="Tassonomia_Esenzioni1" type="checkbox" value="SI" onchange="updateImporto()" onclick="showHidePagamento()"/>
          </td>
          <td>
            <p style="line-height: 1.6;">di essere residente o comunque nato/a in uno dei comuni della Provincia di Trento, salvo zone interdette</p>
          </td>
        </tr>

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Esenzioni" id="Tassonomia_Esenzioni2" name="Tassonomia_Esenzioni2" type="checkbox" value="SI" onchange="updateImporto()" onclick="showHidePagamento()"/>
            </td>
            <td>
              <p style="line-height: 1.6;">di essere proprietario/a o possessore di boschi ricadenti in territorio provinciale, ancorché non residente in un comune della Provincia di Trento, nell'ambito del territorio di loro proprietà</p>
            </td> 
        </tr> 

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Esenzioni" id="Tassonomia_Esenzioni3" name="Tassonomia_Esenzioni3" type="checkbox" value="SI" onchange="updateImporto()" onclick="showHidePagamento()" />
            </td>
            <td>
              <p style="line-height: 1.6;">di essere iscritto/a all'anagrafe degli italiani residenti all'estero (AIRE) di un comune della Provincia di Trento</p>
            </td> 
        </tr> 

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Esenzioni" id="Tassonomia_Esenzioni4" name="Tassonomia_Esenzioni4" type="checkbox" value="SI" onchange="updateImporto()" onclick="showHidePagamento()" />
            </td>
            <td>
              <p style="line-height: 1.6;">di godere di diritto di uso civico, nel territorio di proprietà o gravato dal diritto di uso civico</p>
            </td> 
        </tr> 

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Esenzioni" id="Tassonomia_Esenzioni5" name="Tassonomia_Esenzioni5" type="checkbox" value="SI" onchange="updateImporto()" onclick="showHidePagamento()" />
            </td>
            <td>
              <p style="line-height: 1.6;">di essere in possesso di permessi speciali rilasciati dal Comune di Trento, come gruppi micologici in occasione di mostre, corsi, congressi nazionali ed internazionali, aventi carattere culturale, scientifico, didattico e cittadini residenti per i quali la raccolta costituisce fonte di lavoro e sussistenza.</p>
            </td> 
        </tr> 
    </tbody>
  </table>
{% endblock dichiarazioni_esenzioni %}

<br/>

{% block dichiarazioni_riduzioni %}
<table class="Modulo" name="Dichiarazione_Riduzioni" style="border: 1px solid grey" enabled="!#Tassonomia_Esenzioni_Totale.checked()">
    <tbody>
      <tr class="Rigaintestazione">
        <td colspan="2">
          <p style="line-height: 1.6;">di beneficiare di <b>riduzione pari al 20%</b> dell'importo fissato, per una delle seguenti motivazioni:
          </p>
        </td>
      </tr>
  
        <div id="Tassonomia_Riduzioni" name="Tassonomia_Riduzioni" label="Indicare gli riduzioni di cui si beneficia"></div> 
      
        <tr>
          <td class="tabled-cb">
            <input group="Tassonomia_Riduzioni" id="Tassonomia_Riduzioni1" name="Tassonomia_Riduzioni1" type="checkbox" value="SI" onchange="updateImporto()"/>
          </td>
          <td>
            <p style="line-height: 1.6;">soggiorno a scopi turistici in un comune della Provincia di Trento, per almeno tre giorni consecutivi (due pernottamenti) </p>
          </td>
        </tr>

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Riduzioni" id="Tassonomia_Riduzioni2" name="Tassonomia_Riduzioni2" type="checkbox" value="SI" onchange="updateImporto()"/>
            </td>
            <td>
              <p style="line-height: 1.6;">di essere anagraficamente residente per almeno cinque anni o di avere un genitore anagraficamente residente in un comune della Provincia di Trento</p>
            </td> 
        </tr> 

        <tr>
          <td class="tabled-cb">
              <input group="Tassonomia_Riduzioni" id="Tassonomia_Riduzioni3" name="Tassonomia_Riduzioni3" type="checkbox" value="SI" onchange="updateImporto()" />
            </td>
            <td>
              <p style="line-height: 1.6;">di essere titolare di un diritto di proprietà o altro diritto reale su immobili adibiti ad uso abitativo ubicati in un comune della Provincia di Trento; in tal caso l’agevolazione è limitata al territorio comunale ove è ubicato l’immobile.</p>
            </td> 
        </tr> 
    </tbody>
  </table>
{% endblock dichiarazioni_riduzioni %}


<input type="hidden" id="Tassonomia_Esenzioni_Totale" name="Tassonomia_Esenzioni_Totale" type="checkbox" value="SI" 
  dynamic_check="#Tassonomia_Esenzioni1.checked() ||  #Tassonomia_Esenzioni2.checked() || #Tassonomia_Esenzioni3.checked() || #Tassonomia_Esenzioni4.checked() || #Tassonomia_Esenzioni5.checked()"
  
  />
<input type="hidden" id="Tassonomia_Riduzioni_Totale" name="Tassonomia_Riduzioni_Totale" type="checkbox" value="SI" 
  dynamic_check="#Tassonomia_Riduzioni1.checked() ||  #Tassonomia_Riduzioni2.checked() || #Tassonomia_Riduzioni3.checked()"
  />
<br>

<!-- *********** INIZIO MODULO ALLEGATI *********** -->

<div id="allegati" >
  <h3 class="Modulo">ALLEGA</h3>
  <table class="Modulo" name="Allegati" style="border: 1px solid grey">
    <tbody >
      <tr class="Rigaintestazione">
        <td colspan="2">
          <p style="text-align: center;">
            <b>
              Elenco degli allegati
            </b>
          </p>
        </td>
      </tr>

      <tr>
      <td class="tabled-cb">
      <input id="RIC_DIR_SEG" name="RIC_DIR_SEG" dynamic_check="!#Tassonomia_Esenzioni_Totale.checked()" type="checkbox" value="OBBLIGATORIO" />
      </td>
      <td style="background-color: #eeeeee;" colspan="2">
        <!-- <p>Ricevuta versamento di 16,52 € per bollo rilascio e diritti segreteria/istruttoria: <b>S53 Ambiente - Deroga acustica cantieri/manifestazioni/pubblici esercizi</b></p> -->
        <p>Modulo secondario - <b>Distinta di pagamento: versamento di <label id="importoLabel">importo</label>€ per tassa di raccolta</b><br><u>(completare la distinta con i dati di chi effettua il pagamento e procedere al versamento direttamente da Sportello tramite i pulsanti Paga online oppure Paga con Avviso di pagamento)</u></a>                                                                        
        </p>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- *********** FINE MODULO ALLEGATI *********** -->

<br>
<br>

<!-- *********** INIZIO MODULO PRESA VISIONE *********** -->

<table class="Modulo" name="Accettazione_Informativa_dati" style="border: 1px solid grey">
  <tbody>
      <tr>
        <td class="tabled-cb">
          <div id="Presa_visione" name="Presa_visione" label="Dichiarazione presa visione" mandatory_enabled="true"> </div>
          <input group="Presa_visione" id="Presa_visione_check" name="Presa_visione_check" type="checkbox" value="1" />
        </td>
        <td colspan="2" style="background-color: #eeeeee;">
          <p><b>Dichiaro di aver preso visione dell'<a href="https://sportello.comune.trento.it/document/inform-tratt-dati-utilizzo-sale" target="_blank">informativa relativa al trattamento dei dati personali</a></b><span style="font-size:85%"><i> (artt. 13 e 14 Regolamento UE n. 2016/679)</i></span></p>
        </td>
      </tr>
    </tbody>
  </table>
  
<!-- *********** FINE MODULO PRESA VISIONE *********** -->

<br>
<br>

<!-- *********** INIZIO MODULO FIRMA *********** -->

<table class="Modulo simpatico-block" name="Luogo_e_data" style="border: 1px solid grey">
  <tbody>
    <tr>
      <td style="width: 44%; text-align: center;">
        <input class="" id="Luogo_PDF" name="Luogo_PDF" style="width:80%;" type="text"/>
      </td>
      <td style="width: 44%; text-align: center;">
        <input class="" id="Data_PDF" name="Data_PDF" style="width:50%;" type="text"/>
      </td>
      <td style="width: 44%; text-align: center; height: 1.5cm;">
        <input class="" id="nominativo_richiedente" name="nominativo_richiedente" dynamic_value="' ' + #AventeTitolo_Cognome.value().toUpperCase() + ' ' + #AventeTitolo_Nome.value().toUpperCase()"/>
      </td>
    </tr>
    <tr class="Rigaintestazioneridotta">
      <td>
        <p class="Labelcella" style="text-align: center">Luogo</p>
      </td>
      <td>
        <p class="Labelcella" style="text-align: center">Data</p>
      </td>
      <td>
        <p class="Labelcella" style="text-align: center">Il richiedente</p>
      </td>
    </tr>
  </tbody>
</table>

<!-- *********** FINE MODULO FIRMA *********** -->

<br>
<br>

<!-- *********** INIZIO MODULO INSERIMENTO ALLEGATI E MODULI SECONDARI *********** -->

<p class="Modulo">
  <input id="SalvaModulo" name="SalvaModulo" style="height:40px;width:120px;" title="Verifica la corretta compilazione dei campi e salva il modulo nel faldone virtuale dell'istanza." type="submit" value="Salva modulo" />
</p>
<input destinatario_amministrazione="getParameter('Ente')" id="GLOBO_modulo_c{{ CodiceModulo }}" name="GLOBO_modulo_c{{ CodiceModulo }}" type="hidden" value="" />

<input id="GLOBO_id_padre" name="GLOBO_id_padre" type="hidden" />
<input id="GLOBO_recupera_dati" name="GLOBO_recupera_dati" type="hidden" />
<input id="GLOBO_codice_modulo" name="GLOBO_codice_modulo" type="hidden" value="{{ CodiceModulo }}" />

<input id="Metadati_oggetto" name="Metadati_oggetto" dynamic_value="#Oggetto.value()" type="hidden"/>

<!--allegato atto costitutivo/statuto-->
<input id="GLOBO_allegato_cM0403-A01-ATTO-COSTITUTIVO" name="GLOBO_allegato_cM0403-A01-ATTO-COSTITUTIVO" numero="1" obbligatorio="'OBBLIGATORIO'" type="hidden" value="" />

<!--allegato altra documentazione-->
<input id="GLOBO_allegato_cGEN-ALTRA-DOCUMENTAZIONE" name="GLOBO_allegato_cGEN-ALTRA-DOCUMENTAZIONE" numero="parseInt(#Num_altra_doc.value())" obbligatorio="#Altra_documentazione.checked() ?  'OBBLIGATORIO' : ''" type="hidden" value="" />

<!-- *********** FINE MODULO INSERIMENTO ALLEGATI E MODULI SECONDARI *********** -->

<style>
  .tabled-cb {
    vertical-align: top; 
    width: 4%; 
    padding-top: 0.5em; 
    text-align: center;
  }

    .hidden {
      display: none;
    }

</style>
<script>
  let importo = 10;
  let importoLabel = document.getElementById("importoLabel");
  let importiRB = document.getElementsByName("Periodo_raccolta");
  let esenzioniCB = document.getElementById("Tassonomia_Esenzioni_Totale");
  let riduzioniCB = document.getElementById("Tassonomia_Riduzioni_Totale");
  // inizializza label
  updateImportoLabel();
  
  /** Aggiorna la variabile dell'importo con quanto deve pagare il cittadino */
  function updateImporto() {
      // esenzioni
      if (!!esenzioniCB && esenzioniCB.checked) {
        // esenzione TOTALE
        importo = 0;
        console.log("Esenzione totale", importo);
      } else {
        // calcolo importo
        if (!!importiRB)
          importiRB.forEach(x => {
            console.log(x);
            if (x.checked) {
              // aggiorna importo
              importo = +x.value;
              console.log("Importo senza riduzioni ", importo);
            }
          });

        // applico riduzioni
        if (!!riduzioniCB && riduzioniCB.checked) {
          console.log("Diritto a riduzione su importo di ", importo);
          // riduzione presente
          importo -= importo * 20 / 100;
        } 
      }

      // aggiorna label che mostra importo
      updateImportoLabel();
  }

  /* aggiorna label che mostra importo */
  function updateImportoLabel() {
      if (!!importoLabel)
        // due cifre decimali e sostituisce il char per decimali da . a ,
        importoLabel.innerHTML = importo ? importo.toFixed(2).replace('.', ',') : 0;
  }

  function showHidePagamento() {
    let allegatiElement = document.getElementById("allegati");
    if (!!esenzioniCB && esenzioniCB.checked) {
      allegatiElement.classList.remove('hidden');
    } else 
      allegatiElement.classList.add('hidden');
  }
</script>

{% endblock content %}


